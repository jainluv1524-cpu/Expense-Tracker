<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Expense Tracker</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    @keyframes moneyFlow {
      0% { transform: translateY(-50px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    :root {
      --bg: #f0f4f8;
      --text: #333;
      --card: #ffffff;
      --border: #d1e0e8;
      --primary: #4a90e2;
      --danger: #e57373;
      --success: #66bb6a;
      --accent: #ffd54f;
      --shadow: rgba(0,0,0,0.1);
    }
    [data-theme="dark"] {
      --bg: #0d1117;
      --text: #e6edf3;
      --card: #161b22;
      --border: #30363d;
      --primary: #58a6ff;
      --danger: #ff7b72;
      --success: #56d364;
      --accent: #ffd54f;
      --shadow: rgba(0,0,0,0.3);
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      animation: moneyFlow 0.5s ease-out;
    }
    h1 {
      margin: 0;
      font-size: 2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 6px 20px var(--shadow);
      transition: transform 0.3s;
    }
    .card:hover { transform: translateY(-5px); }
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }
    .summary-box {
      text-align: center;
      padding: 25px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--card), var(--border));
      box-shadow: 0 4px 12px var(--shadow);
      transition: all 0.3s;
    }
    .summary-box:hover { transform: scale(1.05); }
    .income { color: var(--success); }
    .expense { color: var(--danger); }
    .balance { font-size: 2rem; font-weight: bold; }
    .chart-container {
      position: relative;
      height: 400px;
      margin: 40px 0;
      background: var(--card);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px var(--shadow);
    }
    form {
      display: grid;
      gap: 20px;
    }
    input, select, button {
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1.1rem;
      transition: all 0.3s;
    }
    input:focus, select:focus { border-color: var(--primary); outline: none; }
    button {
      background: linear-gradient(135deg, var(--primary), #3b82f6);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    button:hover { transform: scale(1.02); opacity: 0.95; }
    .delete-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .delete-btn:hover { background: #ef5350; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
    }
    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th {
      background: linear-gradient(var(--card), var(--border));
      font-weight: bold;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .theme-toggle:hover { transform: rotate(20deg); }
    .export-btn {
      background: #6b7280;
      margin-left: 15px;
    }
    #loginModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: var(--card);
      padding: 40px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: moneyFlow 0.5s ease-out;
    }
    #monthlyFilter {
      margin-bottom: 20px;
      padding: 14px;
      border-radius: 8px;
    }
    #budgetSection {
      margin-top: 20px;
    }
    #tipsSection {
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, var(--accent), #ffe082);
      border-radius: 12px;
      color: #333;
    }
    #confettiContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--accent);
      animation: confetti 2s linear infinite;
    }
    .running-balance { color: var(--primary); font-weight: bold; }
    #incomeVsExpenseChartContainer {
      height: 400px;
      margin: 40px 0;
    }
  </style>
</head>
<body data-theme="light">

  <div id="confettiContainer"></div>

  <div id="loginModal" style="display: none;">
    <div class="modal-content">
      <h2>ðŸ”’ Login to Expense Tracker</h2>
      <input type="password" id="password" placeholder="Enter Password" required />
      <button onclick="login()">Login</button>
      <p id="loginError" style="color: var(--danger);"></p>
    </div>
  </div>

  <div class="container" id="mainContent" style="display: none;">
    <header>
      <h1><i class="fas fa-wallet"></i> Smart Expense Tracker</h1>
      <div>
        <button class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>
        <button class="export-btn" onclick="exportToCSV()"><i class="fas fa-download"></i> Export CSV</button>
      </div>
    </header>

    <div class="card">
      <h2><i class="fas fa-plus-circle"></i> Add Transaction</h2>
      <form id="transactionForm">
        <input type="number" id="amount" placeholder="Amount (e.g., 500)" min="0" step="0.01" required />
        <select id="type" required>
          <option value="" disabled selected>Type</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <select id="category" required>
          <option value="" disabled selected>Category</option>
          <option value="Salary">Salary</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Shopping">Shopping</option>
          <option value="Bills">Bills</option>
          <option value="Other">Other</option>
        </select>
        <input type="date" id="date" required />
        <input type="text" id="note" placeholder="Note (optional)" />
        <button type="submit"><i class="fas fa-save"></i> Add Transaction</button>
      </form>
      <div id="tipsSection" style="display: none;">
        <h3>Saving Tips for this Category:</h3>
        <ul id="savingTips"></ul>
      </div>
    </div>

    <div class="card">
      <h2><i class="fas fa-filter"></i> Filters & Budget</h2>
      <select id="monthlyFilter">
        <option value="">All Months</option>
      </select>
      <div id="budgetSection">
        <input type="number" id="monthlyBudget" placeholder="Set Monthly Budget (e.g., 50000)" min="0" />
        <button onclick="setBudget()"><i class="fas fa-cog"></i> Set Budget</button>
        <p id="budgetStatus"></p>
      </div>
    </div>

    <div class="summary">
      <div class="summary-box">
        <h3><i class="fas fa-balance-scale"></i> Balance</h3>
        <p class="balance" id="balance">â‚¹0.00</p>
      </div>
      <div class="summary-box income">
        <h3><i class="fas fa-arrow-up"></i> Total Income</h3>
        <p id="totalIncome">â‚¹0.00</p>
      </div>
      <div class="summary-box expense">
        <h3><i class="fas fa-arrow-down"></i> Total Expense</h3>
        <p id="totalExpense">â‚¹0.00</p>
      </div>
    </div>

    <div class="chart-container">
      <h2><i class="fas fa-chart-pie"></i> Expense Breakdown</h2>
      <canvas id="expenseChart"></canvas>
    </div>

    <div class="chart-container" id="incomeVsExpenseChartContainer">
      <h2><i class="fas fa-chart-bar"></i> Income vs Expense (Monthly)</h2>
      <canvas id="incomeVsExpenseChart"></canvas>
    </div>

    <div class="card">
      <h2><i class="fas fa-list"></i> Transactions</h2>
      <table id="transactionsTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Category</th>
            <th>Note</th>
            <th>Running Balance</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="transactionsBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // ==================== DATA & STORAGE ====================
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let passwordHash = localStorage.getItem('passwordHash') || null; // Simple hash for demo (not secure)
    let monthlyBudget = parseFloat(localStorage.getItem('monthlyBudget')) || 0;
    const savingTips = {
      Food: ['Cook at home instead of eating out', 'Buy groceries in bulk', 'Use coupons for discounts'],
      Transport: ['Use public transport', 'Carpool with friends', 'Walk or cycle for short distances'],
      Entertainment: ['Opt for free events', 'Share streaming subscriptions', 'Read books from library'],
      Shopping: ['Make a list before shopping', 'Wait 24 hours before impulse buys', 'Shop during sales'],
      Bills: ['Switch to energy-efficient appliances', 'Unplug devices when not in use', 'Compare providers for better rates'],
      Other: ['Track small expenses', 'Set savings goals', 'Automate savings transfers']
    };

    // ==================== DOM ELEMENTS ====================
    const form = document.getElementById('transactionForm');
    const tableBody = document.getElementById('transactionsBody');
    const balanceEl = document.getElementById('balance');
    const incomeEl = document.getElementById('totalIncome');
    const expenseEl = document.getElementById('totalExpense');
    const chartCanvas = document.getElementById('expenseChart');
    const incomeVsExpenseCanvas = document.getElementById('incomeVsExpenseChart');
    const monthlyFilter = document.getElementById('monthlyFilter');
    const budgetInput = document.getElementById('monthlyBudget');
    const budgetStatus = document.getElementById('budgetStatus');
    const tipsSection = document.getElementById('tipsSection');
    const savingTipsList = document.getElementById('savingTips');
    const loginModal = document.getElementById('loginModal');
    const mainContent = document.getElementById('mainContent');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('loginError');

    let expenseChart;
    let incomeVsExpenseChart;

    // ==================== INIT ====================
    function init() {
      initCharts();
      loadMonthlyFilter();
      if (!passwordHash) {
        setDefaultPassword();
      }
      showLogin();
      budgetInput.value = monthlyBudget || '';
      updateBudgetStatus();
    }

    function setDefaultPassword() {
      passwordHash = btoa('password123'); // Default password: password123 (base64 for demo)
      localStorage.setItem('passwordHash', passwordHash);
    }

    function showLogin() {
      loginModal.style.display = 'flex';
      mainContent.style.display = 'none';
    }

    function login() {
      const entered = btoa(passwordInput.value);
      if (entered === passwordHash) {
        loginModal.style.display = 'none';
        mainContent.style.display = 'block';
        renderAll();
      } else {
        loginError.textContent = 'Incorrect password!';
      }
    }

    // ==================== CHART SETUP ====================
    function initCharts() {
      expenseChart = new Chart(chartCanvas, {
        type: 'pie',
        data: { labels: [], datasets: [{ data: [], backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'] }] },
        options: { responsive: true, plugins: { legend: { position: 'right' } } }
      });

      incomeVsExpenseChart = new Chart(incomeVsExpenseCanvas, {
        type: 'bar',
        data: { labels: [], datasets: [{ label: 'Income', backgroundColor: 'var(--success)', data: [] }, { label: 'Expense', backgroundColor: 'var(--danger)', data: [] }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
    }

    // ==================== CALCULATIONS ====================
    function getFilteredTransactions() {
      const selectedMonth = monthlyFilter.value;
      if (!selectedMonth) return transactions;
      return transactions.filter(t => new Date(t.date).toISOString().slice(0,7) === selectedMonth);
    }

    function calculateSummary(filtered = []) {
      let income = 0;
      let expense = 0;
      const catMap = {};
      const monthlyData = {};

      filtered.forEach(t => {
        const month = new Date(t.date).toISOString().slice(0,7);
        monthlyData[month] = monthlyData[month] || { income: 0, expense: 0 };
        if (t.type === 'income') {
          income += Number(t.amount);
          monthlyData[month].income += Number(t.amount);
        } else {
          expense += Number(t.amount);
          monthlyData[month].expense += Number(t.amount);
          catMap[t.category] = (catMap[t.category] || 0) + Number(t.amount);
        }
      });

      const balance = income - expense;

      incomeEl.textContent = `â‚¹${income.toFixed(2)}`;
      expenseEl.textContent = `â‚¹${expense.toFixed(2)}`;
      balanceEl.textContent = `â‚¹${balance.toFixed(2)}`;
      balanceEl.style.color = balance >= 0 ? 'var(--success)' : 'var(--danger)';

      // Update Pie Chart
      expenseChart.data.labels = Object.keys(catMap);
      expenseChart.data.datasets[0].data = Object.values(catMap);
      expenseChart.update();

      // Update Bar Chart
      const months = Object.keys(monthlyData).sort();
      incomeVsExpenseChart.data.labels = months;
      incomeVsExpenseChart.data.datasets[0].data = months.map(m => monthlyData[m].income);
      incomeVsExpenseChart.data.datasets[1].data = months.map(m => monthlyData[m].expense);
      incomeVsExpenseChart.update();

      return { expense };
    }

    // ==================== RENDER TRANSACTIONS ====================
    function renderTransactions(filtered = []) {
      tableBody.innerHTML = '';
      filtered.sort((a,b) => new Date(b.date) - new Date(a.date));
      let runningBalance = 0;

      filtered.forEach((t, index) => {
        runningBalance += t.type === 'income' ? Number(t.amount) : -Number(t.amount);
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${new Date(t.date).toLocaleDateString()}</td>
          <td style="color:${t.type === 'income' ? 'var(--success)' : 'var(--danger)'}">
            ${t.type === 'income' ? '+' : '-'} â‚¹${Number(t.amount).toFixed(2)}
          </td>
          <td>${t.category}</td>
          <td>${t.note || '-'}</td>
          <td class="running-balance">â‚¹${runningBalance.toFixed(2)}</td>
          <td><button class="delete-btn" onclick="deleteTransaction(${transactions.indexOf(t)})"><i class="fas fa-trash"></i> Delete</button></td>
        `;
        tableBody.appendChild(row);
      });
    }

    function renderAll() {
      const filtered = getFilteredTransactions();
      const { expense } = calculateSummary(filtered);
      renderTransactions(filtered);
      checkBudgetAlert(expense);
    }

    // ==================== ADD TRANSACTION ====================
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const newTransaction = {
        type: document.getElementById('type').value,
        amount: document.getElementById('amount').value,
        category: document.getElementById('category').value,
        date: document.getElementById('date').value,
        note: document.getElementById('note').value.trim()
      };

      transactions.push(newTransaction);
      localStorage.setItem('transactions', JSON.stringify(transactions));

      form.reset();
      renderAll();
      if (newTransaction.type === 'income') triggerConfetti();
      showSavingTips(newTransaction.category);
    });

    // ==================== DELETE TRANSACTION ====================
    function deleteTransaction(index) {
      transactions.splice(index, 1);
      localStorage.setItem('transactions', JSON.stringify(transactions));
      renderAll();
    }

    // ==================== EXPORT CSV ====================
    function exportToCSV() {
      if (transactions.length === 0) return alert("No transactions to export!");
      const headers = ['Date', 'Type', 'Category', 'Amount', 'Note'];
      const rows = transactions.map(t => [t.date, t.type, t.category, t.amount, `"${t.note.replace(/"/g, '""')}"`]);
      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `expenses_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // ==================== DARK MODE ====================
    function toggleTheme() {
      const current = document.body.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);

    // ==================== MONTHLY FILTER ====================
    function loadMonthlyFilter() {
      const months = [...new Set(transactions.map(t => new Date(t.date).toISOString().slice(0,7)))].sort().reverse();
      monthlyFilter.innerHTML = '<option value="">All Months</option>' + months.map(m => `<option value="${m}">${new Date(m).toLocaleString('default', { month: 'long', year: 'numeric' })}</option>`).join('');
    }

    monthlyFilter.addEventListener('change', renderAll);

    // ==================== BUDGET ALERTS ====================
    function setBudget() {
      monthlyBudget = parseFloat(budgetInput.value) || 0;
      localStorage.setItem('monthlyBudget', monthlyBudget);
      updateBudgetStatus();
      renderAll();
    }

    function updateBudgetStatus() {
      budgetStatus.textContent = monthlyBudget > 0 ? `Monthly Budget: â‚¹${monthlyBudget.toFixed(2)}` : '';
    }

    function checkBudgetAlert(currentExpense) {
      if (monthlyBudget > 0 && currentExpense > monthlyBudget) {
        alert(`âš ï¸ Budget Alert: You've exceeded your monthly budget of â‚¹${monthlyBudget.toFixed(2)} by â‚¹${(currentExpense - monthlyBudget).toFixed(2)}!`);
      }
    }

    // ==================== SAVING TIPS ====================
    function showSavingTips(category) {
      const tips = savingTips[category] || savingTips.Other;
      savingTipsList.innerHTML = tips.map(t => `<li>${t}</li>`).join('');
      tipsSection.style.display = 'block';
      setTimeout(() => tipsSection.style.display = 'none', 10000); // Hide after 10s
    }

    // ==================== ANIMATIONS ====================
    function triggerConfetti() {
      const container = document.getElementById('confettiContainer');
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = `${Math.random() * 100}vw`;
        confetti.style.animationDelay = `${Math.random() * 2}s`;
        confetti.style.background = ['var(--success)', 'var(--primary)', 'var(--accent)'][Math.floor(Math.random() * 3)];
        container.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }
    }

    // Start
    init();
  </script>
</body>
</html>